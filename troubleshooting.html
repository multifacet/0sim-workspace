<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Troubleshooting - 0sim User Guide</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "light" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div id="sidebar-scrollbox" class="sidebar-scrollbox">
                <ol class="chapter"><li class="expanded "><a href="overview.html"><strong aria-hidden="true">1.</strong> Overview</a></li><li class="expanded "><a href="requirements.html"><strong aria-hidden="true">2.</strong> Requirements</a></li><li class="expanded "><a href="getting-started.html"><strong aria-hidden="true">3.</strong> Getting Started</a></li><li><ol class="section"><li class="expanded "><a href="cloudlab.html"><strong aria-hidden="true">3.1.</strong> Cloudlab</a></li></ol></li><li class="expanded "><a href="troubleshooting.html" class="active"><strong aria-hidden="true">4.</strong> Troubleshooting</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">0sim User Guide</h1>

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#troubleshooting" id="troubleshooting">Troubleshooting</a></h1>
<p>We will collect common issues here as they are reported...</p>
<ul>
<li>
<p>Vagrant error: <code>Call to virDomainCreateWithFlags failed: internal error: qemu unexpectedly closed the monitor: 2019-11-26T23:49:09.807847Z qemu-kvm: unrecognized feature phys-bits</code></p>
<ul>
<li>Cause: This happens because <code>libvirtd</code> is using an old version of QEMU
packaged with Centos which is masking the recent version compiled from
source by <code>runner</code>.</li>
<li>Solution: Uninstall the old version: <code>sudo yum remove qemu-kvm</code>, and
restart libvirtd: <code>sudo systemctl restart libvirtd</code></li>
</ul>
</li>
<li>
<p>Out of memory (OOM) killing: The target workload is OOM killed near the end
by the target kernel.</p>
<ul>
<li>Cause: unfortunately, the exact amount of memory used by a workload
running on Linux and the exact amount of memory available before
triggering the OOM killer are both difficult quantities to estimate.
They vary from system to system.</li>
<li>Solution: sometimes rerunning the workload may be sufficient. Sometimes
it is necessary to modify the <code>runner</code> script for the experiment to
create a larger target or a smaller workload. Some scripts also have
flags to modify the workload size.</li>
</ul>
</li>
<li>
<p>Kernel <code>ENOSPC</code> when swapping + no apparent progress.</p>
<ul>
<li>Causes: if a thinly-provisioned swap space fills up, the device mapper
system will return a <code>ENOSPC</code> error to the swapping subsystem. One can
see this error in the kernel log on the platform (via <code>dmesg</code>).</li>
<li>Solution: You need a large physical storage device to back the
thin-provisioned device mapper device.</li>
</ul>
</li>
<li>
<p><code>swapon: /dev/sdk: read swap header failed: Invalid argument</code> or similar
on a machine with many storage devices.</p>
<ul>
<li>
<p>Causes: often the devices will move around and get different names after
a reboot. This means that if you configured (via <code>setup00000</code>) 0sim to
use a particular device (say <code>/dev/sdk</code>) for swap space, it might fail
after a reboot.</p>
</li>
<li>
<p>Solution: pass the <code>--unstable_device_names</code> flag to <code>setup00000</code> along
with your other arguments. For example:</p>
<pre><code class="language-console">--swap sda sdh sdi --unstable_device_names
</code></pre>
<p>This will cause setup to use device-id based paths, which are stable.</p>
</li>
</ul>
</li>
</ul>
<h1><a class="header" href="#known-issues" id="known-issues">Known Issues</a></h1>
<p>There are some issues of which we are aware but do not have a good solution.</p>
<ul>
<li>
<p>SSH Errors: &quot;Broken pipe&quot; or &quot;Unable to create channel&quot; or variants</p>
<ul>
<li>Cause: This happens because the target gets so far behind the platform
that the SSH connection times out. Unfortunately, this often happens for
large simulations.</li>
<li>We also suspect that this issue is worsened when Intel EPT (nested paging)
extensions are enabled. One can use <code>runner setup00000</code> to disable EPT
(see usage message).</li>
</ul>
</li>
<li>
<p>Unable to boot target larger than 511GB. <code>vagrant up</code> hangs at &quot;Waiting for
guest to obtain IP&quot; or &quot;Waiting for guest to respond SSH&quot;.</p>
<ul>
<li>
<p>Cause: Often this happens on standard personal computers (as opposed to
server-class machines) when Intel EPT is enabled. These are part of
Intel's extended/nested paging extensions. Most non-server processors we
have tested have 39 physical-address bits, which is enough to address
512GB of memory. By enabling EPT, the processor is forced to translate
addresses that are too wide. QEMU manifests this by conveniently and
inexplicably hanging at guest boot time without any error messages.</p>
</li>
<li>
<p>Solution: Disable EPT on the platform machine. This can be done through
the runner (<code>setup00000</code>):</p>
<pre><code>./runner setup00000 {MACHINE} {USER} --disable_ept
</code></pre>
</li>
</ul>
</li>
<li>
<p>Unable to boot target larger than 1028GB on machine without EPT on some machines.</p>
<ul>
<li>Cause: We believe this is a KVM bug but are not 100% sure. The fact that
1024-1027GB machines boot and run indicates that this is not a hardware
limitation.</li>
</ul>
</li>
<li>
<p>Unable to boot large multicore target.</p>
<ul>
<li>Cause: This also happens with stock KVM. We suspect this is due to some
sort of hardware timeout when KVM emulates devices during boot, but we
are not really sure.</li>
<li>Disabling TSC offsetting during target boot can solve this in some cases.</li>
<li>In some cases, running with 1023GB instead of &gt;=1024GB resolves the
issue. This seems like a KVM bug.</li>
</ul>
</li>
<li>
<p>Hanging/Unresponsive Remote. Occasionally, the simulation platform becomes
unresponsive. It is ok to forcibly reset the remote, even if the machine is
booted.</p>
<ul>
<li>This may cause the target's VM image to become corrupted. The image can
be recreated by rerunning the appropriate <code>setup*</code> <code>runner</code> subcommands.
Note that a subset of flags can be passed to <code>setup00000</code> (e.g. one does
not need to keep passing <code>--host_kernel</code>). The <code>--DESTROY_EXISTING</code> flag
will destroy any existing target VM.</li>
</ul>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="cloudlab.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="cloudlab.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
            </nav>

        </div>

        

        

        
        
        
        <script type="text/javascript">
            window.playpen_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
